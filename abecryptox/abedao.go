package abecryptox

import (
	"github.com/pqabelian/abec/abecryptox/abecryptoxkey"
	"github.com/pqabelian/abec/abecryptox/abecryptoxparam"
	"github.com/pqabelian/abec/wire"
)

// AbeTxOutputDesc defines the description for Txo generation.
// reviewed on 2023.12.07
type AbeTxOutputDesc struct {
	cryptoAddress []byte // generated by CryptoAddressKeyGen
	value         uint64
}

func (a AbeTxOutputDesc) CryptoAddress() []byte {
	return a.cryptoAddress
}

func (a AbeTxOutputDesc) Value() uint64 {
	return a.value
}

// NewAbeTxOutDesc constructs a new AbeTxOutputDesc from the input (cryptoAddress []byte, value uint64).
// reviewed on 2023.12.07
func NewAbeTxOutDesc(cryptoAddress []byte, value uint64) *AbeTxOutputDesc {
	return &AbeTxOutputDesc{
		cryptoAddress: cryptoAddress,
		value:         value,
	}
}

//func (abeTxOutputDesc *AbeTxOutputDesc) GetValue() uint64 {
//	return abeTxOutputDesc.value
//}

// AbeTxInputDescByRootSeeds defines the information that will be need to spend a TxoCoin, in TransferTxGen.
// The information consists of Root Seeds and coinDetectorRootKey.
// NOTE: The (Root Seeds, Root Key) should be those used to generate the cryptoAddress.
// NOTE: As cryptoAddress=cryptoScheme+privacyLevel+coinAddress, these coinXXXRootSeeds is purely randomness, without containing cryptoScheme or privacyLevel,
// this is because, generating these (Root Seeds, Root Key) is the responsibility of the caller of abecrypto.
type AbeTxInputDescByRootSeeds struct {
	// ringId        *wire.RingId  // txoRing identifier
	txoRing                     *wire.TxoRing                // complete TxoRing information
	sidx                        uint8                        // spend which one
	cryptoScheme                abecryptoxparam.CryptoScheme // address, generated by CryptoAddressKeyGen
	privacyLevel                abecryptoxkey.PrivacyLevel
	coinSpendKeyRootSeed        []byte // coinSpendKeyRootSeed, provided by the caller of abecrypto
	coinSerialNumberKeyRootSeed []byte // coinSerialNumberKeyRootSeed, provided by the caller of abecrypto; for Pseudonym-Privacy coin, this should be nil
	coinValueKeyRootSeed        []byte // coinValueKeyRootSeed, provided by the caller of abecrypto; for Pseudonym-Privacy coin, this should be nil
	coinDetectorRootKey         []byte // coinDetectorRootKey, provided by the caller of abecrypto
	value                       uint64
}

// AbeTxInputDescByRandSeeds
// todo: review
type AbeTxInputDescByRandSeeds struct {
	// ringId        *wire.RingId  // txoRing identifier
	txoRing                     *wire.TxoRing                // complete TxoRing information
	sidx                        uint8                        // spend which one
	cryptoScheme                abecryptoxparam.CryptoScheme // address, generated by CryptoAddressKeyGen
	privacyLevel                abecryptoxkey.PrivacyLevel
	coinSpendKeyRandSeed        []byte // coinSpendKeyRandSeed, provided by the caller of abecrypto
	coinSerialNumberKeyRandSeed []byte // coinSerialNumberKeyRandSeed, provided by the caller of abecrypto; for Pseudonym-Privacy coin, this should be nil
	coinValueKeyRandSeed        []byte // coinValueKeyRandSeed, provided by the caller of abecrypto; for Pseudonym-Privacy coin, this should be nil
	coinDetectorKey             []byte // coinDetectorKey, provided by the caller of abecrypto
	value                       uint64
}

// AbeTxInputDesc defines the data that are need to spend a TxoCoin, in TransferTxGen.
// reviewed on 2023.12.21
// todo: review
type AbeTxInputDescByKeys struct {
	txoRing           *wire.TxoRing // complete TxoRing information
	sidx              uint8         // spend which one
	cryptoAddress     []byte        // address, generated by CryptoAddressKeyGen
	cryptoSpsk        []byte        // spend secret key, generated by CryptoAddressKeyGen
	cryptoSnsk        []byte        //  serial-number secret key, generated by CryptoAddressKeyGen; for Pseudonym-Privacy coin, this should be nil
	cryptoVsk         []byte        //  view secret key, generated by CryptoAddressKeyGen; for Pseudonym-Privacy coin, this should be nil
	cryptoDetectorKey []byte        //	a symmetric key for coin-detection; for RingCTPre, this should be nil
	value             uint64
}

// NewAbeTxInputDescByRootSeeds constructs a new NewAbeTxInputDescByRootSeeds.
// todo: review
func NewAbeTxInputDescByRootSeeds(
	txoRing *wire.TxoRing, sidx uint8,
	cryptoScheme abecryptoxparam.CryptoScheme, privacyLevel abecryptoxkey.PrivacyLevel,
	coinSpendKeyRootSeed []byte, coinSerialNumberKeyRootSeed []byte, coinValueKeyRootSeed []byte, coinDetectorRootKey []byte,
	value uint64) *AbeTxInputDescByRootSeeds {
	return &AbeTxInputDescByRootSeeds{
		txoRing:                     txoRing,
		sidx:                        sidx,
		cryptoScheme:                cryptoScheme,
		privacyLevel:                privacyLevel,
		coinSpendKeyRootSeed:        coinSpendKeyRootSeed,
		coinSerialNumberKeyRootSeed: coinSerialNumberKeyRootSeed,
		coinValueKeyRootSeed:        coinValueKeyRootSeed,
		coinDetectorRootKey:         coinDetectorRootKey,
		value:                       value,
	}
}

func NewAbeTxInputDescByRandSeeds(
	txoRing *wire.TxoRing, sidx uint8,
	cryptoScheme abecryptoxparam.CryptoScheme, privacyLevel abecryptoxkey.PrivacyLevel,
	coinSpendKeyRandSeed []byte, coinSerialNumberKeyRandSeed []byte, coinValueKeyRandSeed []byte, coinDetectorKey []byte,
	value uint64) *AbeTxInputDescByRandSeeds {
	return &AbeTxInputDescByRandSeeds{
		txoRing:                     txoRing,
		sidx:                        sidx,
		cryptoScheme:                cryptoScheme,
		privacyLevel:                privacyLevel,
		coinSpendKeyRandSeed:        coinSpendKeyRandSeed,
		coinSerialNumberKeyRandSeed: coinSerialNumberKeyRandSeed,
		coinValueKeyRandSeed:        coinValueKeyRandSeed,
		coinDetectorKey:             coinDetectorKey,
		value:                       value,
	}
}

// NewAbeTxInputDescByKeys constructs a new NewAbeTxInputDescByKeys.
// reviewed on 2023.12.21
func NewAbeTxInputDescByKeys(
	txoRing *wire.TxoRing, sidx uint8,
	cryptoAddress []byte,
	cryptoSpsk []byte, cryptoSnsk []byte, cryptoVsk []byte, cryptoDetectorKey []byte,
	value uint64) *AbeTxInputDescByKeys {
	return &AbeTxInputDescByKeys{
		txoRing:           txoRing,
		sidx:              sidx,
		cryptoAddress:     cryptoAddress,
		cryptoSpsk:        cryptoSpsk,
		cryptoSnsk:        cryptoSnsk,
		cryptoVsk:         cryptoVsk,
		cryptoDetectorKey: cryptoDetectorKey,
		value:             value,
	}
}

// AbeTxInDetail defines the data describing a consumed TxoCoin in TransferTx, which will be used in TransferTxVerify
// reviewed on 2023.12.21
type AbeTxInDetail struct {
	ringId       wire.RingId // txoRing identifier
	txoList      []*wire.TxOutAbe
	serialNumber []byte
}

// NewAbeTxInDetail constructs a new NewAbeTxInDetail.
// reviewed on 2023.12.21
func NewAbeTxInDetail(ringId wire.RingId, txoList []*wire.TxOutAbe, serialNumber []byte) *AbeTxInDetail {
	return &AbeTxInDetail{
		ringId:       ringId,
		txoList:      txoList,
		serialNumber: serialNumber,
	}
}

//	data structures for abec side	end
