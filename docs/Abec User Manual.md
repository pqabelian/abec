# Abec User Manual

The following instruction will lead you to create and run a full node and a wallet of abec.

We start from abewallet first since we should create our wallet first and then use the wallet address for mining in abec.

## 1. Download Abewallet and Abec

After getting a new version of **Abewallet** and **Abec** in compressed format, unzip them and store them in some folder as two separate sub-folders, for example, abel/abewallet and abel/abec, respectively.

## 2. Create a wallet

To create a wallet,

```shell
# Macos and Linux
./start_abewallet.sh --create
# Windows
abewallet --create
```

**Hint 1:** On Macos and Linux, you may need to run `chmod 777 xxx` if it says ` xxx: Permission denied`. Then run abewallet again. Same when launching abec later.

**Hint 2**: On Macos, if it says `'xxx' cannot be opened because the developer cannot be verified`, go to `System Preferences -> Security & Privacy -> General` and click `allow anyway`. Then run abewallet again. Same when launching abec later.

Following the construction to create the wallet. An example is shown below.

```shell
./start_abewallet.sh --create
Enter the private passphrase for your new wallet:
Confirm passphrase:
Enter the public passphrase for your new wallet:
Confirm passphrase:
NOTE: Use the --walletpass option to configure your public passphrase.
Do you have an existing wallet seed you want to use? (n/no/y/yes) [no]:
Your wallet generation seed is:
afe0f025646cde3eee099db9215f8cdb212ed0e06730fd0087e9d1ff5565fd53
the crypto version is 0
Your wallet mnemonic list is:
quiz,always,announce,silver,social,buyer,return,crisp,rice,april,tobacco,rent,base,half,light,toward,wonder,aerobic,whip,physical,vocal,real,vocal,leg
IMPORTANT: Keep the version and seed in a safe place as you
will NOT be able to restore your wallet without it.
Please keep in mind that anyone who has access
to the seed can also restore your wallet thereby
giving them access to all your funds, so it is
imperative that you keep it in a secure location.
Once you have stored the seed in a safe and secure location, enter "OK" to continue: OK
Creating the wallet...
Please remember the initial address:
00000000005a38589d86427698e3ec735335b368899ed6e0239c4285bbc4e370f4ea4e6d2ac1f1555b53f8df7c30e13d4bccc3b6d56763ec279620d9f131fb68089cb8ef18885950f84e56bf78d1780a5cac57d0888dabd669f86f85e7055afabae6a332fa000b3c6ee6a09751ce41ad7de4e...
```

The **public passphrase** would be used when launching abewallet, and the **private passphrase** would be used to unlock the wallet (to spend money etc.). Notice that both public passphrase and private passphrase are required.

Keep the **crypto version** and  **mnemonic list** in a safe place, it can be used to recover the wallet.

The **initial address** can be used as mining address or payment address later.

## 3. Launch Abec

You should run Abec first to generate a configuration file. 

```shell
# Macos and Linux
./start_abec.sh
# Windows
abec
```

Then press control+C to shutdown it.

You can find configuration file named *abec.conf* in **home directory** of the system. That is in

- Windows: C:\\Users\\[username]\\AppData\\Local\\Abec
- Macos: /Users/[username]/Library/Application Support/Abec
- Linux: /home/[username]/.abec

These folders are the **configuration folders** of Abec. Some configurations are needed to be carried out as follows.

### Peers

In abec.conf, we use addpeer to add some specific Abelian nodes so that you can connect to the Abelian mainnet.

```
addpeer = [IP:PORT]
```

For example, to connect to some other peers for your node, we add the following lines in abec.conf.

```
addpeer = 3.145.81.196:8666
addpeer = 18.117.106.180
addpeer = 3.66.221.224
addpeer = 3.120.150.60
addpeer = 112.120.106.200:8501
addpeer = 112.120.106.200:8511
addpeer = 112.120.106.200:8521
```

If you do not specify the port, default port (8666) will be used.

### RPC Server

To let Abewallet connect with Abec correctly, the options rpcuser / rpcpass need to be configured. 

```
rpcuser = [administrator username]
rpcpass = [administrator password]
```

You may keep those automatically generated rpcuser and rpcpass values unchanged, and also create two more lines, namely

```
rpclimituser = [username]
rpclimitpass = [password]
```

as long as the values of rpcuser and rpclimituser should be different.

### Mining

If you want to run a mining node, miningaddr option needs to be configured. Paste the initial address generated by Abewallet above.

```
miningaddr = [your initial address]
```

After finishing the configuration, we can start Abec

```shell
# Macos and Linux
./start_abec.sh --generate
# Windows
abec --generate
```

The above command make Abec start mining. If you do not want to let Abec go mining, just run

```shell
# Macos and Linux
./start_abec.sh
# Windows
abec
```

Example:

```shell
./start_abec.sh --generate
2022-04-16 20:28:50.804 [INF] ABEC: Version 0.9.5-alpha
2022-04-16 20:28:50.837 [INF] ABEC: Loading block database from 'C:\Users\username\AppData\Local\Abec\data\mainnet\blocks_ffldb'
2022-04-16 20:28:50.848 [INF] ABEC: Block database loaded
2022-04-16 20:28:50.862 [INF] CHAN: Loading block index...
2022-04-16 20:28:50.862 [INF] CHAN: Chain state (height 17, hash 00000050ec9493c9f615dae1300b2f64e18220eca7bb4e17885cb87b3a9b5d2c, totaltx 19, work 150996096)
2022-04-16 20:28:50.865 [INF] RPCS: RPC server listening on 0.0.0.0:8667
2022-04-16 20:28:50.865 [INF] AMGR: Loaded 0 addresses from file 'C:\Users\username\AppData\Local\Abec\data\mainnet\peers.json'
2022-04-16 20:28:50.865 [INF] CMGR: Server listening on 0.0.0.0:8666
2022-04-16 20:28:50.865 [INF] CMGR: Server listening on [::]:8666
```

### Other options

Other options and their usage can be found in abec.conf.

## 4. Connect Abewallet to Abec

**Notice**: For security concern, Abewallet should run on a secure machine instead of the same machine with Abec. Moreover, if you run multiple Abec, there is no need to create Abewallet for each Abec, namely one wallet is enough. You only need to add the mining address to each Abec and connect Abewallet to one of them.

When you run Abewallet the first time, it will create an configuration file called *abewallet.conf*. Like Abec, it is located in the home directory of system, that is

- Windows: C:\Users\username\AppData\Local\Abewallet
- Macos: /Users/username/Library/Application Support/Abewallet
- Linux: /home/username/.abewallet

These folders are the **configuration folders** of Abewallet.

If you want to connect Abewallet with Abec, you should first configure the abecusername and the abecpassword options in *abewallet.conf* before running abewallet. These should be the same as rpcuser and rpcpass options specified in *abec.conf*.

```
abecusername= [rpcuser]
abecpassword= [rpcpass]
```

In addition, in order to interact with Abewallet later (using Abectl), username and password should also be configured, (any username and password is fine)

```
username= [username]
password= [password]
```

Besides the above configuration, the other things you should do depends on whether or not Abec and Abewallet are on the same machine.

### Abec and Abewallet are on different machine

If Abec and Abewallet are on different machine, you also should 

- specify the ip address and port of Abec
- Get the certificate of Abec

To **specify the ip address of Abec**, add this option in *abewallet.conf*,

```
rpcconnect= [IP:PORT]
```

IP and PORT is the ip address and listen port of Abec. If port is not specified, it will use default port (8667). 

To **get the certificate of Abec**, you should copy *rpc.cert* from the configuration folder of Abec, and paste it into the configuration folder of Abewallet. 

After finishing these operations, run Abewallet,

```shell
# Macos and Linux
./start_abewallet.sh --walletpass=[your public passphrase]
# Windows
abewallet --walletpass=[your public passphrase]
```

### Abec and Abewallet are on the same machine

Congratulations! You can run Abewallet without other operations. Abewallet will automatically detect the certificate of Abec and connect with it.

```shell
# Macos and Linux
./start_abewallet.sh --walletpass=[your public passphrase]
# Windows
abewallet --walletpass=[your public passphrase]
```



Example:

```shell
./start_abewallet.sh --walletpass=123456
2022-04-16 12:51:33.344 [INF] WLLT: Opened wallet
2022-04-16 12:54:29.015 [INF] ABEW: Version 0.9.5-alpha
2022-04-16 12:54:29.047 [INF] RPCS: Listening on [::1]:8665
2022-04-16 12:54:29.047 [INF] RPCS: Listening on 127.0.0.1:8665
2022-04-16 12:54:29.048 [INF] ABEW: Attempting RPC client connection to localhost:8667
2022-04-16 12:54:29.378 [INF] CHNS: Established connection to RPC server localhost:8667
2022-04-16 12:54:29.917 [INF] WLLT: Opened wallet
2022-04-16 12:54:30.939 [INF] WLLT: RECOVERY MODE ENABLED -- rescanning for used addresses with recovery_window=250
2022-04-16 12:54:30.956 [INF] WLLT: Catching up block hashes to height 6, this might take a while
2022-04-16 12:54:30.965 [INF] TMGR: Current sync height 1
2022-04-16 12:54:30.973 [INF] TMGR: Current sync height 2
2022-04-16 12:54:30.990 [INF] TMGR: Current sync height 3
2022-04-16 12:54:30.999 [INF] TMGR: Current sync height 4
2022-04-16 12:54:31.004 [INF] TMGR: Current sync height 5
2022-04-16 12:54:31.034 [INF] TMGR: Current sync height 6
2022-04-16 12:54:31.036 [INF] WLLT: Done catching up block hashes
2022-04-16 12:54:36.374 [INF] TMGR: Current sync height 7
```



## 5. Operate Abewallet using abectl

In the abec folder, there is another executable called start_abectl.sh (Macos and Linux) or abectl (Windows). This executable can be used for checking balance of your wallet, make payment, and so on.

***As of this writing, only balance checking is supported.***

### 5.1 Check balance

Like Abewallet and Abec, Abectl and Abewallet do not need to be on the same machine. 

#### If Abectl and Abewallet are on the same machine

```shell
# Macos and Linux
./start_abectl.sh --rpcuser=[username] --rpcpass=[password] --wallet getbalancesabe
# Windows
abectl --rpcuser=[username] --rpcpass=[password] --wallet getbalancesabe
```

*username* and *password* should be the same as the options we configured in *abewallet.conf*.

Example:

```shell
./start_abectl.sh --rpcuser=username --rpcpass=password --wallet getbalancesabe
[
  4508,
  2971.9892438,
  1536.0107562,
  0,
  7
]
```

From the top to the bottom

- total balance
- spendable balance
- freezed coinbase balance
- freezed transaction balance
- number of blocks need to be updated. Especially, when querying the currency value after restoring the wallet, if the value is not zero, it means that the balance query is not necessarily accurate.

#### If Abectl and Abewallet are on different machine

If Abectl and Abewallet are on different machine, you should also

- Specify the ip address and port of Abewallet
- Get the certificate of Abewallet

To specify the ip address and port, add `--rpcserver=[IP:PORT]`.

To get the certificate of Abewallet, you should copy *rpc.cert* from the configuration folder of Abewallet, and paste it in any place in the machine which runs Abectl. Add `--rpccert=[location of cert]`.

**Notice**: We omit the above operations in the following description of Abectl.

```shell
# Macos and Linux
./start_abectl.sh --rpcuser=[username] --rpcpass=[password] --rpcserver=[IP:PORT] --rpccert=[location of cert] --wallet getbalancesabe
# Windows
abectl --rpcuser=[username] --rpcpass=[password] --rpcserver=[IP:PORT] --rpccert=[location of cert] --wallet getbalancesabe
```

Example:

```shell
./start_abectl.sh --rpcuser=username --rpcpass=password --rpcserver=192.168.1.3:8665 --rpccert=/home/username/rpc.cert --wallet getbalancesabe
[
  4508,
  2971.9892438,
  1536.0107562,
  0,
  7
]
```

### 5.2 Unlock 

Before you send transactions or generate new address, you should unlock the wallet first.

```shell
# Macos and Linux
./start_abectl.sh --rpcuser=[rpcuser] --rpcpass=[rpcpass] --wallet walletpassphrase [your private passphrase] [timeout]
# Windows
abectl --rpcuser=[rpcuser] --rpcpass=[rpcpass] --wallet walletpassphrase [your private passphrase] [timeout]
```

**NOTE**: The unit of timeout is second.

Example:

```shell
./start_abectl.sh --rpcuser=[rpcuser] --rpcpass=[rpcpass] --wallet walletpassphrase 123456 240
```

This means unlock the wallet with passphrase 123456 for  240 seconds.

### 5.3 Generate new address

To generate a new address (to receive coins)

```shell
# Macos and Linux
./start_abectl.sh --rpcuser=[rpcuser] --rpcpass=[rpcpass] --wallet generateaddressabe
# Windows
abectl --rpcuser=[rpcuser] --rpcpass=[rpcpass] --wallet generateaddressabe
```

### 5.4 Send to address

Since the address in Abec is very long, we cannot directly paste them in the command line. Instead, we should create a file called *args1* in the configuration folder of Abec (this may change in the future) and add receiver's address and amount into it.

The format is as follows.

```
[
    {
        "address":"addr1",
        "amount":700000000
    },
    {
        "address":"addr2",
        "amount":500000000
    }
]
```

Note that the unit of amount is **Neutrino**. (1 ABE = 10000000 Neutrino)

And then we can send transaction by

```shell
# Macos and Linux
./start_abectl.sh --rpcuser=[rpcuser] --rpcpass=[rpcpass] --wallet sendtoaddressesabe -
# Windows
abectl --rpcuser=[rpcuser] --rpcpass=[rpcpass] --wallet sendtoaddressesabe -
```

Example:

```shell
$ cat /Users/username/Library/Application Support/Abec/arg1
[{"address":"addr1", "amount":700000000},{"address":"addr2", "amount":500000000 }]
$ ./start_abectl.sh --rpcuser=[rpcuser] --rpcpass=[rpcpass] --wallet sendtoaddressesabe -
```

We omit the rest of the address for simplicity. This means we send 70 ABE to addr1 and 50 ABE to addr2.

### 5.5 Recover the wallet

If you want to recover the wallet, you can delete the data (*mainnet/wallet.db* in configuration folder of Abewallet) of your wallet and run

```shell
# Macos and Linux
./start_abewallet.sh --create
# Windows
abewallet --create
```

Example:

```shell
$ ./start_abewallet.sh --create
Enter the private passphrase for your new wallet:
Confirm passphrase:
Enter the public passphrase for your new wallet:
Confirm passphrase:
NOTE: Use the --walletpass option to configure your public passphrase.
Do you have an existing wallet seed you want to use? (n/no/y/yes) [no]: y
Enter the crypto version is:0
Enter existing wallet mnemonic: biology,hazard,sudden,dignity,drop,jealous,butter,believe,answer,enter,practice,scorpion,health,tunnel,rival,vault,neutral,season,proof,must,path,steel,final,female
Enter the restore number of address :3
Creating the wallet...
Please remember the initial address:
0002000000d066f987f3061cb1def09052d14706d5f398ecf00800ad4dfdf65b24f204eee609f9f0fb1e855ff3f80ead6cfc3e973743f8bf530f25f4ca0945e2f0d04e0ee40d3cdc9bd6f789daeeb700f4c8373e0f322ccdaa010fec461bff2a0b2b3ff992b0338e04bb0cc89c068fecb4f5f576dc54bbfd236faf3ff9acde7e29f5b55092d406d6940726fd77841871f05dae336f06dab699c808ec4407830ca9b7a3e0f52e7dcc190614ebd8a8fcbf1448bc05df4bcea8fc573becfdfadc8377810621a562f70cffe06e1802eb751d46f0d72511af0ccf0317df0bf0da429c08193e7d0b0328c0d4ca070a41d2a9...
```

The number of address restored depends on how many number of address you have created before.

### 5.6 Refresh the wallet

When recovering the wallet, the wallet balance would be inaccurate, after unlock the wallet, you can  run

```shell
# Macos and Linux
./start_abectl.sh --rpcuser=[rpcuser] --rpcpass=[rpcpass] --wallet freshen
# Windows
abectl --rpcuser=[rpcuser] --rpcpass=[rpcpass] --wallet refresh
```

It would return "true" as response.

